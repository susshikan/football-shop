{% extends 'base.html' %}

{% block meta %}
  <title>Edit Produk â€” Vintage Sports</title>
{% endblock meta %}

{% block content %}
<section class="max-w-3xl mx-auto">
  <h1 class="font-display text-2xl">Edit Produk</h1>
  <p class="mt-1 text-neutral-600">Perbarui informasi produk vintage Anda.</p>

  <div class="mt-6 card p-6">
    <form id="edit-form-page" method="POST" class="space-y-5">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <ul class="errorlist">{{ form.non_field_errors }}</ul>
      {% endif %}

      <div class="space-y-1">
        <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
        {{ form.name }}
        {{ form.name.errors }}
      </div>

      <div class="space-y-1">
        <label for="{{ form.price.id_for_label }}">{{ form.price.label }}</label>
        {{ form.price }}
        {{ form.price.errors }}
      </div>

      <div class="space-y-1">
        <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
        {{ form.description }}
        {{ form.description.errors }}
      </div>

      <div class="space-y-1">
        <label for="{{ form.thumbnail.id_for_label }}">{{ form.thumbnail.label }}</label>
        {{ form.thumbnail }}
        {{ form.thumbnail.errors }}
      </div>

      <div class="space-y-1">
        <label for="{{ form.category.id_for_label }}">{{ form.category.label }}</label>
        {{ form.category }}
        {{ form.category.errors }}
      </div>

      <div class="space-y-1">
        <label for="{{ form.history_value.id_for_label }}">{{ form.history_value.label }}</label>
        {{ form.history_value }}
        {{ form.history_value.errors }}
      </div>

      <div class="flex items-center gap-2">
        {{ form.is_featured }}
        <label for="{{ form.is_featured.id_for_label }}" class="m-0">{{ form.is_featured.label }}</label>
        {{ form.is_featured.errors }}
      </div>

      <div>
        <input class="btn-primary" type="submit" value="Simpan Perubahan"/>
      </div>
    </form>
  </div>
</section>
<script>
  (function(){
    const form = document.getElementById('edit-form-page');
    if (!form) return;
    function getCSRFToken(){
      const name='csrftoken='; const parts=(document.cookie||'').split(';');
      for(let c of parts){ c=c.trim(); if(c.startsWith(name)) return decodeURIComponent(c.substring(name.length)); }
      return '';
    }
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const formData = new FormData(form);
      try{
        const res = await fetch("{% url 'main:update_product_ajax' product_id %}", { method:'POST', headers:{ 'X-CSRFToken': getCSRFToken() }, body: formData });
        const data = await res.json();
        if (!res.ok || !data.success) throw new Error('Update failed');
        if (window.queueToast) { queueToast('Tersimpan', 'Produk berhasil diperbarui.', 'success'); }
        window.location.href = "{% url 'main:show_main' %}";
      }catch(err){
        console.error(err);
        if (window.showToast) showToast('Gagal', 'Tidak dapat menyimpan perubahan.', 'error');
      }
    });
  })();
</script>
{% endblock %}
